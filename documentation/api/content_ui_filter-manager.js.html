<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: content/ui/filter-manager.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: content/ui/filter-manager.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>// Filter management for article list

/**
 * Find article container element
 * @returns {HTMLElement|null} Article container or null
 */
function findArticleContainer() {
  // Use cached findArticleElements to avoid repeated querySelector
  const articleElements = findArticleElements();
  const firstArticle = articleElements.length > 0 ? articleElements[0] : null;
  if (!firstArticle) return null;
  
  return firstArticle.closest(CONFIG.selectors.articleContainer) ||
         firstArticle.closest(CONFIG.selectors.articleSection) ||
         firstArticle.closest('section') || 
         firstArticle.closest(CONFIG.selectors.articleSectionFallback) ||
         firstArticle.parentElement;
}

/**
 * Create filter button
 * @param {Object} filter - Filter object with value and label
 * @param {string} currentFilter - Current active filter
 * @param {Function} setPageFilter - Function to set filter
 * @returns {HTMLButtonElement} Filter button element
 */
function createFilterButton(filter, currentFilter, setPageFilter) {
  const btn = document.createElement('button');
  btn.textContent = filter.label;
  btn.dataset.filter = filter.value;
  btn.className = 'lethain-filter-btn';
  
  if (currentFilter === filter.value) {
    btn.classList.add('active');
  }

  btn.addEventListener('click', () => {
    setPageFilter(filter.value);
    const buttons = document.querySelectorAll('.lethain-filter-btn');
    buttons.forEach(btn => {
      btn.classList.toggle('active', btn.dataset.filter === filter.value);
    });
  });

  return btn;
}

/**
 * Create filter control UI
 * @param {string} currentFilter - Current active filter
 * @param {Function} setPageFilter - Function to set filter
 */
function createFilterControl(currentFilter, setPageFilter) {
  if (document.getElementById(CONFIG.selectors.filterControl.substring(1))) {
    return;
  }

  // Use cached findArticleElements to avoid repeated querySelector
  const articleElements = findArticleElements();
  const firstArticle = articleElements.length > 0 ? articleElements[0] : null;
  if (!firstArticle) {
    return;
  }

  const filterContainer = document.createElement('div');
  filterContainer.id = CONFIG.selectors.filterControl.substring(1);

  const filterButtons = document.createElement('div');
  filterButtons.className = 'lethain-filter-buttons';

  const filterLabel = document.createElement('span');
  filterLabel.textContent = 'Filter:';
  filterLabel.className = 'lethain-filter-label';

  const filters = [
    { value: CONFIG.filters.all, label: 'All' },
    { value: CONFIG.filters.unread, label: 'Unread' },
    { value: CONFIG.filters.read, label: 'Read' }
  ];

  filters.forEach(filter => {
    const btn = createFilterButton(filter, currentFilter, setPageFilter);
    filterButtons.appendChild(btn);
  });

  filterContainer.appendChild(filterLabel);
  filterContainer.appendChild(filterButtons);
  
  const relativeDiv = firstArticle.closest(CONFIG.selectors.articleContainer);
  
  if (relativeDiv) {
    const firstChildArticle = relativeDiv.querySelector(CONFIG.selectors.article);
    
    if (firstChildArticle) {
      relativeDiv.insertBefore(filterContainer, firstChildArticle);
    } else if (relativeDiv.firstChild) {
      relativeDiv.insertBefore(filterContainer, relativeDiv.firstChild);
    } else {
      relativeDiv.appendChild(filterContainer);
    }
  } else {
    const parent = firstArticle.parentElement;
    if (parent) {
      parent.insertBefore(filterContainer, firstArticle);
    }
  }
}

/**
 * Show all articles
 * @param {NodeList} articleElements - Article elements
 * @param {HTMLElement|null} articleContainer - Article container
 */
function showAllArticles(articleElements, articleContainer) {
  articleElements.forEach(el => el.classList.remove('lethain-article-hidden'));
  if (articleContainer &amp;&amp; articleContainer.dataset.lethainOriginalWidth) {
    articleContainer.style.width = '';
    articleContainer.style.minWidth = '';
    delete articleContainer.dataset.lethainOriginalWidth;
  }
}

/**
 * Preserve container width
 * @param {HTMLElement|null} articleContainer - Article container
 */
function preserveContainerWidth(articleContainer) {
  if (articleContainer &amp;&amp; !articleContainer.dataset.lethainOriginalWidth) {
    const computedStyle = window.getComputedStyle(articleContainer);
    const currentWidth = computedStyle.width;
    if (currentWidth &amp;&amp; currentWidth !== 'auto') {
      articleContainer.dataset.lethainOriginalWidth = currentWidth;
      articleContainer.style.width = currentWidth;
      articleContainer.style.minWidth = currentWidth;
    }
  }
}

/**
 * Filter articles by read status
 * @param {NodeList} articleElements - Article elements
 * @param {Object} articles - Articles cache object
 * @param {string} currentFilter - Current filter value
 */
function filterByReadStatus(articleElements, articles, currentFilter) {
  // Early return if cache is empty or invalid
  if (!articles || typeof articles !== 'object' || Object.keys(articles).length === 0) {
    // If cache is empty, show all articles for safety
    Logger.debug('Filter: Cache is empty, showing all articles');
    return;
  }
  
  const filterRead = currentFilter === CONFIG.filters.read;
  const filterUnread = currentFilter === CONFIG.filters.unread;
  
  // Use traditional for loop for better performance
  for (let i = 0; i &lt; articleElements.length; i++) {
    const articleEl = articleElements[i];
    const link = extractLink(articleEl);
    
    if (!link) {
      articleEl.classList.add('lethain-article-hidden');
      continue;
    }

    const url = link.href || link.getAttribute('href');
    if (!url || !validateUrl(url)) {
      articleEl.classList.add('lethain-article-hidden');
      continue;
    }

    const article = getArticleFromCache(url);
    const isRead = article?.isRead || false;
    
    // Determine if article should be shown based on filter
    let shouldShow = true;
    if (filterRead) {
      shouldShow = isRead;
    } else if (filterUnread) {
      shouldShow = !isRead;
    }

    articleEl.classList.toggle('lethain-article-hidden', !shouldShow);
  }
}

/**
 * Apply filter to article list
 * @param {string} currentFilter - Current filter value
 * @param {Function} getArticlesCache - Cache getter function
 */
async function applyFilter(currentFilter, getArticlesCache) {
  // Use cached findArticleElements to avoid repeated querySelectorAll
  const articleElements = findArticleElements();
  if (articleElements.length === 0) return;

  const articleContainer = findArticleContainer();

  if (currentFilter === CONFIG.filters.all) {
    showAllArticles(articleElements, articleContainer);
    return;
  }

  preserveContainerWidth(articleContainer);
  const articles = await getArticlesCache();
  filterByReadStatus(articleElements, articles, currentFilter);
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="PageState.html">PageState</a></li></ul><h3>Global</h3><ul><li><a href="global.html#applyFilter">applyFilter</a></li><li><a href="global.html#attachCheckboxListeners">attachCheckboxListeners</a></li><li><a href="global.html#attachTooltipListeners">attachTooltipListeners</a></li><li><a href="global.html#createCheckbox">createCheckbox</a></li><li><a href="global.html#createExportData">createExportData</a></li><li><a href="global.html#createFilterButton">createFilterButton</a></li><li><a href="global.html#createFilterControl">createFilterControl</a></li><li><a href="global.html#createMutationObserver">createMutationObserver</a></li><li><a href="global.html#createPageStorage">createPageStorage</a></li><li><a href="global.html#createStatusContainer">createStatusContainer</a></li><li><a href="global.html#createStatusIcon">createStatusIcon</a></li><li><a href="global.html#createTooltip">createTooltip</a></li><li><a href="global.html#createTooltipCloseHandler">createTooltipCloseHandler</a></li><li><a href="global.html#createTrackingUI">createTrackingUI</a></li><li><a href="global.html#determineReadStatus">determineReadStatus</a></li><li><a href="global.html#downloadJSON">downloadJSON</a></li><li><a href="global.html#extractArticleFromElement">extractArticleFromElement</a></li><li><a href="global.html#extractArticles">extractArticles</a></li><li><a href="global.html#extractDateFromText">extractDateFromText</a></li><li><a href="global.html#extractLink">extractLink</a></li><li><a href="global.html#extractTime">extractTime</a></li><li><a href="global.html#filterByReadStatus">filterByReadStatus</a></li><li><a href="global.html#findArticleContainer">findArticleContainer</a></li><li><a href="global.html#findArticleElements">findArticleElements</a></li><li><a href="global.html#formatDateFull">formatDateFull</a></li><li><a href="global.html#getArticle">getArticle</a></li><li><a href="global.html#getArticleFromCache">getArticleFromCache</a></li><li><a href="global.html#getArticlesCache">getArticlesCache</a></li><li><a href="global.html#getCurrentDateISO">getCurrentDateISO</a></li><li><a href="global.html#getExistingArticlesMap">getExistingArticlesMap</a></li><li><a href="global.html#getOrCreateArticle">getOrCreateArticle</a></li><li><a href="global.html#getStorageKey">getStorageKey</a></li><li><a href="global.html#handleArticleStatusChange">handleArticleStatusChange</a></li><li><a href="global.html#handleFilterControlPosition">handleFilterControlPosition</a></li><li><a href="global.html#handleTooltipClose">handleTooltipClose</a></li><li><a href="global.html#handleTooltipOpen">handleTooltipOpen</a></li><li><a href="global.html#hasNewArticles">hasNewArticles</a></li><li><a href="global.html#importDataFromFile">importDataFromFile</a></li><li><a href="global.html#injectTrackingUI">injectTrackingUI</a></li><li><a href="global.html#invalidateArticleElementsCache">invalidateArticleElementsCache</a></li><li><a href="global.html#invalidateCache">invalidateCache</a></li><li><a href="global.html#isLethainDomain">isLethainDomain</a></li><li><a href="global.html#isMainPage">isMainPage</a></li><li><a href="global.html#markAsRead">markAsRead</a></li><li><a href="global.html#markAsUnread">markAsUnread</a></li><li><a href="global.html#mergeArticleDataForImport">mergeArticleDataForImport</a></li><li><a href="global.html#mergeArticleState">mergeArticleState</a></li><li><a href="global.html#normalizeUrl">normalizeUrl</a></li><li><a href="global.html#onDOMReady">onDOMReady</a></li><li><a href="global.html#preserveContainerWidth">preserveContainerWidth</a></li><li><a href="global.html#processImportBatch">processImportBatch</a></li><li><a href="global.html#querySelectorWithFallback">querySelectorWithFallback</a></li><li><a href="global.html#scheduleFilterApplication">scheduleFilterApplication</a></li><li><a href="global.html#setResourceManager">setResourceManager</a></li><li><a href="global.html#showAllArticles">showAllArticles</a></li><li><a href="global.html#startObserving">startObserving</a></li><li><a href="global.html#toggleTooltip">toggleTooltip</a></li><li><a href="global.html#updateCacheArticle">updateCacheArticle</a></li><li><a href="global.html#updateLinkStyles">updateLinkStyles</a></li><li><a href="global.html#updateStatusIcon">updateStatusIcon</a></li><li><a href="global.html#updateUIAfterStatusChange">updateUIAfterStatusChange</a></li><li><a href="global.html#validateArticle">validateArticle</a></li><li><a href="global.html#validateArticleStructure">validateArticleStructure</a></li><li><a href="global.html#validateImportData">validateImportData</a></li><li><a href="global.html#validateUrl">validateUrl</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.5</a> on Thu Nov 20 2025 11:45:27 GMT-0300 (Brasilia Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
